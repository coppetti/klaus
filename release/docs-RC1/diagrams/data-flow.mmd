%% IDE Agent Wizard - Data Flow
%% Use with Mermaid: https://mermaid.live

sequenceDiagram
    autonumber
    
    participant User as User
    participant IDE as IDE/Editor
    participant Connector as IDE Connector
    participant Memory as Memory Store
    participant Agent as Agent Core
    participant Provider as LLM Provider
    
    Note over User,Provider: IDE Mode Flow
    
    User->>IDE: Type question
    IDE->>Connector: process_message()
    
    Connector->>Memory: get_context(message)
    Memory-->>Connector: relevant_history + facts
    
    Connector->>Agent: generate(context, message)
    
    Agent->>Provider: API request
    Provider-->>Agent: LLM response
    
    Agent-->>Connector: response
    Connector->>Memory: store_interaction(q, a)
    
    Connector-->>IDE: formatted response
    IDE-->>User: Display answer
    
    Note over User,Provider: Telegram Mode Flow
    
    User->>Telegram: Send message
    Telegram->>Bot: Webhook/Poll
    Bot->>KimiAgent: HTTP POST /chat
    
    KimiAgent->>Memory: get_context(message)
    Memory-->>KimiAgent: context
    
    KimiAgent->>Provider: API request
    Provider-->>KimiAgent: response
    
    KimiAgent-->>Bot: JSON response
    Bot->>Memory: store_interaction(q, a)
    Bot->>Telegram: Send message
    Telegram-->>User: Display answer
